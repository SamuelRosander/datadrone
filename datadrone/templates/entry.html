{% extends "layout.html" %}

{% block body %}

<div class="right">
  <a href="{{ url_for('entry_delete', entry_id=entry.entry_id) }}" class="link-small" onClick="return confirm('Are you sure you want to delete this entry?')">Delete</a>
</div>
<h3>Entry</h3>
<form method="POST" action="">
  {{ form.hidden_tag() }}

  <span class="entry-label">Item:</span><a href="{{ url_for('details', item_id=entry.item.item_id) }}">{{ entry.item.itemname }}</a><br>
  <br>

  <span class="entry-label fixed-width">Timestamp:</span>{{ form.date(class="form-small") }}
  {% if form.date.errors %}
    {% for error in form.date.errors %}
      <span class="form-small-flash">{{ error }}</span>
    {% endfor %}
  {% endif %}<br>

  <span class="entry-label fixed-width">&nbsp;</span>{{ form.time(class="form-small") }}
  {% if form.time.errors %}
    {% for error in form.time.errors %}
      <span class="form-small-flash">{{ error }}</span>
    {% endfor %}
  {% endif %}<br>

  <span class="entry-label fixed-width">Latitude:</span>{{ form.latitude(class="form-small") }}
  {% if form.latitude.errors %}
    {% for error in form.latitude.errors %}
      <span class="form-small-flash">{{ error }}</span>
    {% endfor %}
  {% endif %}<br>

  <span class="entry-label fixed-width">Longitude:</span>{{ form.longitude(class="form-small") }}
  {% if form.longitude.errors %}
    {% for error in form.longitude.errors %}
      <span class="form-small-flash">{{ error }}</span>
    {% endfor %}
  {% endif %}<br>

  <span class="entry-label fixed-width">Comment:</span>{{ form.comment(class="form-small") }}<br>
  <br>
  {% for entrytag in entry.entrytags %}
    {{ entrytag.tag.name }}
  {% endfor %}
  <br>
  <h3 class="inline">Tags</h3> <a href="#" class="link-small">Show all</a><br>
    <div class="tag-container">
      {% for tag in entry.item.tags %}
        {% if not tag.deleted %}
          <label for="tag-{{ tag.tag_id }}" class="tag-box-large">
            <input type="checkbox" class="tag-label-checkbox" name="tag-{{ tag.tag_id }}" id="tag-{{ tag.tag_id }}"><span class="tag-text-up">{{ tag.name }}</span>
          </label>
        {% endif %}
      {% endfor %}
    </div>

<br>
<div id="map"></div>
<script>
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        {% if entry.latitude and entry.longitude %}
          zoom: 15,
          center: {lat: {{ entry.latitude }}, lng: {{ entry.longitude }}},
        {% else %}
          zoom: 1,
          center: {lat: 0, lng: 0},
        {% endif %}
        mapTypeControl: false,
        streetViewControl: false,
        clickableIcons: false
    });

    markers = [];
    {% if entry.latitude and entry.longitude %}
      var marker = new google.maps.Marker({
        position:{lat: {{ entry.latitude }}, lng: {{ entry.longitude }}},
        map:map
      });
      markers.push(marker);
    {% endif %}

    map.addListener('click', function(e) {
      for (var i=0; i<markers.length; i++) {
        markers[i].setMap(null);
      }
      placeMarker(e.latLng, map);
      document.getElementById("latitude").value = e.latLng.lat();
      document.getElementById("longitude").value = e.latLng.lng();
    });

    function placeMarker(position, map) {
      var marker = new google.maps.Marker({
        position: position,
        map: map
      });
      markers.push(marker);
    map.panTo(position);
    }
  }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCv89Lm44klib2QbXjtUy38jFosKg5ET0g&callback=initMap">
</script>
<script src="{{ url_for('static', filename='js/jquery.js')}}"></script>
<script src="{{url_for('static', filename='js/entry.js')}}"></script>

{{ form.submit(class="form large-button") }}

</form>
{% endblock %}
